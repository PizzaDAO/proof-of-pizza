generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

model Submission {
  id              String           @id @default(cuid())

  // Submitter info
  walletAddress   String           // Ethereum address or resolved ENS
  ensName         String?          // Original ENS if provided

  // Images
  pizzaPhotoUrl   String           // R2 URL for pizza photo
  receiptPhotoUrl String           // R2 URL for receipt photo

  // Receipt data
  extractedAmount Decimal          @db.Decimal(10, 2) // AI-extracted amount
  finalAmount     Decimal          @db.Decimal(10, 2) // User-confirmed amount
  currency        String           @default("USD")

  // Status
  status          SubmissionStatus @default(PENDING)

  // Admin/Payment
  reviewedBy      String?          // Admin wallet address
  reviewedAt      DateTime?
  rejectionReason String?

  // Transaction
  transactionHash String?          // Base transaction hash
  paidAt          DateTime?
  paidAmount      Decimal?         @db.Decimal(18, 6) // USDC amount (6 decimals)

  // Metadata
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([status])
  @@index([walletAddress])
  @@index([createdAt])
}

// Future: For authorized reimbursers with smart contract wallet
model AuthorizedReimburser {
  id            String   @id @default(cuid())
  walletAddress String   @unique
  name          String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
